- ui = this

.ui
  .messages_container
    %pre.messages
      - each @messages, (message) ->
        = message
    .toggle
      = "="
      - on "click", (e) ->
        - $(e.currentTarget).parent().toggleClass("hidden")
  .characters_container
    - each @characters, (character) ->
      - activeClass = -> "active" if map.activeCharacter() is character
      - stunned = "stunned" if character.stunned()
      .character(class="#{activeClass stunned}")
        %img.bolt(src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAJCAYAAAD6reaeAAAAJ0lEQVQIW2NkwAT/GdHE/gP5jMiCYAGQIpggXAAmCBJAAVQyE8UYAFBxCQhl+Rv2AAAAAElFTkSuQmCC")
        .health
          - character.health().times ->
            %img.heart(src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAAXklEQVQYV2NkAII1Rkb/QXTIuXOMIBqbGCNIka6qIVjy8u3zYMXYxFAEYYphGpE1YyiEWQ2jYbaA3YRsFbJCmCKQGIrjsVkJ0whXiGwysklYFcIUIwcTToXoniFZIQACVkALUKk9JAAAAABJRU5ErkJggg==")
        %img.avatar(src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAD8klEQVRYR8WWXUiTYRTHzxLb2jQ/t+UckqYrI2yZ5bpRsg+iQoS8ybIiL+zKi7Cki/AuKy1CCIUgUlMj04hASk30IkoSU4gCs4ThRzaTJD9WCWvncWc877v33d6l1LnZnq9zfud/zvNsKqMp1QVu00XH4ofX1GHh8HPuB8zPTAvmlQymJj6olOzDPSoCEEPo9HpYWnQyPzP2UYG/0KVJSf+t9Tcg92wVBAVgTtrJFPjtXGBOeSUQYt7hgF8Ly2vZyWtgcnoWhse+SgJYzAaouFLG1jIPFSlSQUUA5JFAQjVaWKvVsuAYmAwB0OQgsq0pbF2v18Gtxp6AED4AfGp8YJq/fq0aLpaVSCqBCqSlmsDhmIeS8+eguaEhIIQsAAXHTI4XFkL1zVrA4GRjU+/ZXO/gR8DAZAiAhmfQAkFIAvDBMRs0Pnjt3Vo4eiSLAfCliYuNEPSGEhV8ACg4HsYAqMCF0gqBY8zebNwqmMOy8EbK4Zy/hpQEwEajWvKZi4PwylRWXfLGJ/lpAhNp7Hgj2ZACALpmeJDkdB9kfsbfvmKf8Tv2eMcERJByEIoApDqez5ACu1zs2QCVajkhAsPvCITS80YNHFABuSvHO0MIAqB5MYi4TNRLAQFg7hPQI0LO+frTnJQSqALN86ogDPrAppVrxOUecAdHQwCs+YmDu9hYCkAM0lpZCrb9x+BMcTF09A35lIcUQSWkILCQLrMhEvIPWOFR56AiFQjidVcr+2rLKwKY+w4mq01QfywPJiMXnPUSAdBJetXoFsipQMH35Z6ECMt2mB0egsjNVuaGb1RS068CeAhV4CH8AWBwkh3PtDTUw4vu52CzZTEX1A856RY2xl9I2R5AYF43AkEl+KfVXz8IdPcMCotOQ/fAcOBfQ38A6EsKgjWWKgS0ag1o1FqYmXX4NCzukbt6PDDrAXEGvApiCLbXHTx/7ym43XIf1mnUsG2TAexfPnshlAZnrjIzDjOAb5MTMDI+6GWRKwVuKC+/Ck+aO+BxbycYoqJh0emEtBQjTDjs7LySzCmQKjneKlAgJs4Eff3tbB0hxLeioCAdYjfshqjwjfD0QRe09TyDiLD1bohF2JIYATVtnQHrLigBKoDZi41AqJP5XkCIpqYBz5EQyMnIgySTGeraa+Be+8vVASAgLIsUBA+MQC0P3wUdnPVAXIzFpXP/AZUzVAIVSjAuCG6EeH8wdfcpATWhLIVnQQ7ib4MLFKBM/SlhHx2B/q46toV+ZFYS3AvAB8VyyMHgPA/hfnKDajip5FgPSC1QX4hhcNx25zK+9ysOLqmAHAyB/BcAgkpITGY3wvNG/DsFeFUQwv1Srkpw9PsHOCrIMC73i/kAAAAASUVORK5CYII=")
        .name= character.name()

  .actions
    - each @actions, (action) ->
      - activeClass = -> "active" if action.active
      - disabledClass = -> "disabled" if action.disabled
      .action(class=activeClass class=disabledClass style="background-image: url(#{action.icon})")
        - if action.cooldown
          .cooldown= action.cooldown
        .costs
          .container
            - action.cost?.times ->
              - typeClass = -> "rest" if action.costType?() is 2
              .cost(class=typeClass)
        = action.name

        - on "click", ->
          - unless action.disabled
            - action.perform()
            - ui.actionPerformed()
