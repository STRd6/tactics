<!DOCTYPE html>

<html>
<head>
  <title>tile</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="http://strd6.github.io/cdn/parallel/docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    <ul class="sections">
        
        
        <li id="section-1">
            <div class="annotation">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <h1 id="tile">Tile</h1>

            </div>
            <div class="content"><pre><code class="lang-coffeescript">
</code></pre>
</div>
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>A tile in the isometric board.</p>

            </div>
            <div class="content"><pre><code class="lang-coffeescript"><span class="function"><span class="title">Tile</span></span> = (I={}) -&gt;
  {sha, back} = I

  img = $(<span class="string">"&lt;img&gt;"</span>,
    src: Resource.url(sha)
    load: -&gt;
      self.height = <span class="property">@height</span>
  ).get(<span class="number">0</span>)

  <span class="keyword">if</span> back
    backImg = $(<span class="string">"&lt;img&gt;"</span>,
      src: Resource.url(back)
      load: -&gt;
        self.backHeight = <span class="property">@height</span>
    ).get(<span class="number">0</span>)

  self = Object.extend {},
    __proto__: Tile::
    img: img
    backImg: backImg
    orientation: [<span class="number">1</span>, <span class="number">0</span>]
  , I

Tile:: =
  toJSON: -&gt;
    _.omit(@, <span class="string">"img"</span>, <span class="string">"backImg"</span>)

  present: -&gt;
    frontUrl: Resource.url <span class="property">@sha</span>
    backUrl: Resource.url(<span class="property">@back</span> || <span class="property">@sha</span>)

  draw: (canvas, x, y, cameraRotation=Matrix.IDENTITY) -&gt;
    imgHeight = imgWidth = <span class="number">64</span> <span class="comment"># TODO real size</span>
    orientation = cameraRotation.deltaTransformPoint(<span class="property">@orientation</span>).round()

    hflip = orientation.y

    back = (orientation.x + orientation.y) &lt; <span class="number">0</span>
    <span class="keyword">if</span> back &amp;&amp; <span class="property">@backImg</span>
      hflip = !hflip
      img = <span class="property">@backImg</span>

      offset = <span class="number">64</span> - (<span class="property">@backHeight</span> <span class="keyword">or</span> <span class="property">@height</span>)
    <span class="keyword">else</span>
      img = <span class="property">@img</span>
      offset = <span class="number">64</span> - <span class="property">@height</span>

    <span class="keyword">if</span> hflip
      transform = Matrix.HORIZONTAL_FLIP
    <span class="keyword">else</span>
      transform = Matrix.IDENTITY

    canvas.withTransform Matrix.translation(x + imgWidth<span class="regexp">/2, y + imgHeight/</span><span class="number">2</span> + offset), =&gt;
      canvas.withTransform transform, =&gt;
        canvas.drawImage(img, -imgWidth<span class="regexp">/2, -imgHeight/</span><span class="number">2</span>)

module.exports = Tile</code></pre>
</div>
        </li>
        
    </ul>
  </div>
  <script src="//code.jquery.com/jquery-1.10.1.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/coffee-script/1.6.3/coffee-script.min.js"></script>
<script src="http://strd6.github.io/require/v0.2.2.js"></script>
<script src="http://strd6.github.io/interactive/v0.8.0.js"></script>
<script src="http://strd6.github.io/tempest/javascripts/envweb-v0.4.5.js"></script><script src="package.js"></script>
</body>
</html>