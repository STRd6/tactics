<!DOCTYPE html>

<html>
<head>
  <title>abilities</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="http://strd6.github.io/cdn/parallel/docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    <ul class="sections">
        
        
        <li id="section-1">
            <div class="annotation">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            <div class="content"><pre><code class="lang-coffeescript">Constants = require "./ability_constants"

{SELF, MOVEMENT, LINE_OF_SIGHT, ANY} =  Constants.TARGET_ZONE
{REST, FIXED} = Constants.COST_TYPE

{sqrt} = Math

module.exports =
  Move:
    name: "Move"
    description: "Old boot-y. Hoof it to your next position."
    iconName: "boots"
    actionCost: 1
    targetZone: MOVEMENT
    code: '''
      owner.addEffect
        name: "moving"
        attribute: "physicalAwareness"
        amount: -100
        duration: 1

      # Need to reverse because the effects go on a stack.
      positions = movementPath.copy().reverse()

      positions.forEach (position, i) -&gt;
        to = position
        from = positions[i+1]

        if to and from
          effect "Move", from, to, owner
    '''

  Teleport:
    name: "Teleport"
    description: "Magically appear in a far away location."
    iconName: "teleport"
    actionCost: 2
    range: 50
    targetZone: ANY
    code: '''
      effect "Move", owner.position(), position

      if character
        owner.I.health = 0
        character.I.health = 0

        message "#{owner.name()} teleports into #{character.name()}. There are no survivors."
    '''

  Blink:
    name: "Blink"
    description: "Move somewhere you can see in the blink of an eye."
    iconName: "blink"
    actionCost: 1
    range: 8
    targetZone: LINE_OF_SIGHT
    code: '''
      effect "Move", owner.position(), position

      if character
        owner.I.health = 0
        character.I.health = 0

        message "#{owner.name()} teleports into #{character.name()}."
        message "Life ends in the blink of an eye."
    '''

  Death:
    name: "Death"
    description: "It's probably Ebola. Be careful."
    iconName: "black_cloud"
    actionCost: 2
    range: 8
    targetZone: ANY
    code: '''
      effect "PestilentVapor", position
    '''

  "Stun Gas":
    name: "Stun Gas"
    description: "Silent but deadly"
    iconName: "green_cloud"
    actionCost: 2
    range: 8
    targetZone: LINE_OF_SIGHT
    code: '''
      effect "Stun Gas", position
    '''

  Farsight:
    name: "Farsight"
    description: "Use your mind's eye to visualize lands you've never seen."
    iconName: "farsight"
    actionCost: 1
    range: 16
    targetZone: ANY
    code: '''
      animate
        message: "#{owner.name()}'s wizard eyes see all!"
        position: position
        duration: 2000

      search.adjacent(position, 1 + sqrt(2)).forEach (position) -&gt;
        owner.addMagicalVision(position)
    '''

  Heal:
    name: "Heal"
    description: "A permanent BandAid."
    iconName: "regeneration"
    range: sqrt(2)
    actionCost: 2
    cooldown: 2
    costType: REST
    targetZone: LINE_OF_SIGHT
    code: '''
      if character
        amount = 2

        if character.I.passives.include("Undead")
          method = "damage"
        else
          method = "heal"

        character[method] amount

        message "#{owner.name()} #{method}s #{character.name()} for #{amount}"
    '''

  Melee:
    name: "Attack"
    description: "Hit enemies with it until they die."
    iconName: "sword"
    range: sqrt(2)
    actionCost: 1
    costType: REST
    targetZone: LINE_OF_SIGHT
    code: '''
      if character
        amount = binomial(owner.strength()) + 1
        character.damage amount

        message "#{owner.name()} strikes #{character.name()} for #{amount}"
    '''

  Ranged:
    name: "Attack"
    description: "Nice for those who don't like to get their hands dirty."
    iconName: "longbow"
    range: 7
    actionCost: 1
    costType: REST
    targetZone: LINE_OF_SIGHT
    code: '''
      if character
        amount = binomial(owner.strength())
        character.damage amount

        message "#{owner.name()} strikes #{character.name()} for #{amount}."
    '''

  IceWall:
    name: "Ice Wall"
    description: "Block your enemies with a giant block of ice."
    iconName: "frozen0"
    range:16
    actionCost: 1
    targetZone: ANY
    code: '''
      if character
        message "#{owner.name()} cannot summon ice. #{character.name()} is in the way."
      else
        effect "Ice", position
    '''

  MagicMissile:
    name: "Magic Missile"
    description: "It's not that kind of missile."
    iconName: "magic_missile"
    range: 8
    actionCost: 1
    costType: REST
    targetZone: LINE_OF_SIGHT
    code: '''
      if character
        # TODO make this based on intelligence
        # or some other attribute
        amount = binomial(owner.strength())
        character.damage amount

        message "#{owner.name()} strikes #{character.name()} with a Magic Missile for #{amount}."
    '''

  Berserk:
    name: "Berserk"
    description: "My hate for you is ticking clock."
    iconName: "sword"
    range: sqrt(2)
    actionCost: 1
    targetZone: LINE_OF_SIGHT
    code: '''
      if character
        amount = binomial(owner.strength()) + 1
        character.damage amount

        message "#{owner.name()} strikes #{character.name()} for #{amount}"
    '''

  Blind:
    name: "Blind"
    description: "Use this when your enemies are too good at seeing you."
    iconName: "blind"
    range: 8
    actionCost: 1
    costType: REST
    targetZone: LINE_OF_SIGHT
    code: '''
      if character
        character.addEffect
          name: "blindness"
          attribute: "sight"
          amount: -100
          duration: 3
    '''

  Poison:
    name: "Poison"
    description: "Poison, my one weakness."
    iconName: "poison"
    range: 8
    actionCost: 1
    costType: REST
    targetZone: LINE_OF_SIGHT
    code: '''
      character?.addEffect
        name: "poison"
        duration: 3
        update: (character) -&gt;
          message "The poison takes its toll on #{character.name()}."
          character.damage(1, "Poison")
    '''

  Regeneration:
    name: "Regeneration"
    description: "Those who regenerate today live to fight another day."
    iconName: "regeneration"
    actionCost: 1
    costType: REST
    targetZone: SELF
    code: '''
      amount = 1
      owner.heal(amount)
      message "#{owner.name()} regenerates #{amount} health."
    '''

  Entanglement:
    name: "Entanglement"
    description: "It's like the times you used to pick blackberries as a kid."
    iconName: "bush0"
    range: 7
    actionCost: 2
    cooldown: 3
    costType: REST
    targetZone: LINE_OF_SIGHT
    code: '''
      search.adjacent(position, 1 + sqrt(2)).forEach (position) -&gt;
        effect "Plant", position
    '''

  Demolish:
    name: "Demolish"
    description: "Smash everything on a single tile."
    iconName: "bomb"
    range: sqrt(2)
    actionCost: 1
    targetZone: ANY
    code: '''
      effect "Demolish", position, owner
    '''

  Stomp:
    name: "Stomp"
    description: "Destroy everything around you."
    iconName: "stomp"
    range: 1
    actionCost: 2
    cooldown: 2
    targetZone: SELF
    code: '''
      effect "Stomp", position, owner
    '''

  Fireball:
    name: "Fireball"
    description: "Immolated ball of death. Watch out for dry brush."
    iconName: "fireball"
    range: 7
    actionCost: 2
    cooldown: 3
    costType: REST
    targetZone: LINE_OF_SIGHT
    code: '''
      search.adjacent(position, 1 + sqrt(2)).forEach (position) -&gt;
        effect "Fire", position
    '''

  ShrubSight:
    name: "ShrubSight"
    description: "Somehow you know where all the plants are."
    iconName: "bush1"
    actionCost: 1
    cooldown: 2
    targetZone: SELF
    code: '''
      effect "ShrubSight", position, owner
    '''

  Entomb:
    name: "Entomb"
    description: "Stone seals all"
    actionCost: 2
    costType: REST
    cooldown: 2
    range: 7
    targetZone: LINE_OF_SIGHT
    code: '''
      effect "Entomb", position, owner
    '''

  Stonesight:
    name: "Stonesight"
    description: ""
    actionCost: 1
    targetZone: ANY
    range: 7
    code: '''
      effect "Stonesight", position, owner
    '''

  Wait:
    name: "Wait"
    description: "Do this if you don't have any other good moves."
    iconName: "hourglass"
    actionCost: 0
    costType: REST
    targetZone: SELF
    code: '''
    '''</code></pre>
</div>
        </li>
        
    </ul>
  </div>
  <script src="https://code.jquery.com/jquery-1.10.1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/coffee-script/1.6.3/coffee-script.min.js"></script>
<script src="http://strd6.github.io/tempest/javascripts/envweb-v0.4.7.js"></script><script>
  (function() {
  var ErrorReporter, bindUpdates, createEditor, exec, findInteractiveElements, readShebang, runners;

  createEditor = function(code, shebang, section) {
    var annotationElement, contentElement, editorElement, exampleSection, runtimeElement;
    exampleSection = $("<li>", {
      "class": "example"
    });
    annotationElement = $("<div>", {
      "class": "annotation"
    });
    editorElement = $("<textarea>", {
      "class": "annotation",
      text: code
    });
    contentElement = $("<div>", {
      "class": "content"
    });
    runtimeElement = $("<div>", {
      "class": "output"
    });
    contentElement.append(runtimeElement);
    annotationElement.append(editorElement);
    exampleSection.append(annotationElement);
    exampleSection.append(contentElement);
    section.after(exampleSection);
    return bindUpdates(shebang, editorElement, runtimeElement);
  };

  bindUpdates = function(shebang, editorElement, runtimeElement) {
    return editorElement.on("keyup", function() {
      var e, report, source;
      report = ErrorReporter(editorElement);
      source = editorElement.val();
      try {
        runners[shebang]({
          editorElement: editorElement,
          source: source,
          runtimeElement: runtimeElement
        });
        return report.clear();
      } catch (_error) {
        e = _error;
        return report(e);
      }
    });
  };

  readShebang = function(source) {
    var match;
    if (match = source.match(/^\#\! (.*)\n/)) {
      return match[1];
    }
  };

  ErrorReporter = function(editor) {
    var reporter;
    reporter = function(error) {
      var errorParagraph;
      if (editor.next().is("p.error")) {
        return editor.next().text(error);
      } else {
        errorParagraph = $("<p>", {
          "class": "error",
          text: error.toString()
        });
        return editor.after(errorParagraph);
      }
    };
    reporter.clear = function() {
      if (editor.next().is("p.error")) {
        return editor.next().remove();
      }
    };
    return reporter;
  };

  findInteractiveElements = function() {
    return $("blockquote > pre > code").each(function() {
      var blockQuoteElement, code, codeElement, sectionElement, shebang;
      codeElement = $(this);
      code = codeElement.text();
      if (shebang = readShebang(code)) {
        if (!runners[shebang]) {
          return;
        }
        code = code.split("\n").slice(1).join("\n");
        blockQuoteElement = codeElement.parent().parent();
        sectionElement = blockQuoteElement.parent().parent();
        blockQuoteElement.remove();
        return createEditor(code, shebang, sectionElement);
      }
    });
  };

  runners = {};

  (typeof window !== "undefined" && window !== null ? window : global).Interactive = {
    register: function(name, runner) {
      runners[name] = runner;
      findInteractiveElements();
      return $('#container').on('keyup', 'textarea', function() {
        $(this).height(0);
        return $(this).height(this.scrollHeight);
      }).find('textarea').keyup();
    }
  };

  exec = function(_arg) {
    var code, editorElement, runtimeElement, source;
    source = _arg.source, code = _arg.code, editorElement = _arg.editorElement, runtimeElement = _arg.runtimeElement;
    runtimeElement.remove();
    editorElement.replaceWith($("<pre>", {
      text: source
    }));
    return setTimeout(function() {
      return Function(code)();
    }, 0);
  };

  Interactive.register("setup", function(params) {
    params.code = CoffeeScript.compile(params.source);
    return exec(params);
  });

  Interactive.register("setup-js", function(params) {
    params.code = params.source;
    return exec(params);
  });

  $(function() {
    return findInteractiveElements();
  });

}).call(this);

//# sourceURL=interactive.coffee
</script><script src="package.js"></script>
</body>
</html>